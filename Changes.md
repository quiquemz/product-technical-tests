# Boutiques + Google Places ID

## Changes
### Versioning
I decided to create a new version "v2" for the API so that previous work remained untouched. For this version I added three new endpoints:

 - GET /v2/boutiques/{slug}
 - POST /v2/boutiques
 - PUT /v2/boutiques/{slug}

### Schema

    new Schema({
	    name: {type: Schema.Types.String, required: true},
	    slug: {type: Schema.Types.String, required: true, unique: true},
	    location: {
	      lon: {type: Schema.Types.Number, required: true},
	      lat: {type: Schema.Types.Number, required: true}
	    },
	    description: {type: Schema.Types.String, required: true},
	    google_places_id: {type: Schema.Types.String, required: true},
	    founder_quote: Schema.Types.String,
	    logo: {
	        url: Schema.Types.String
	    }
	})


### Routes
GET /v2/boutiques/{slug}:
 - **Purpose**: Find a boutique in the DB given a slug.
 - **Considerations**: I decided to create this function as I believe it is always helpful to find a specific object when needed. Instead of having to parse through the whole list of boutiques, if the users have a specific slug available they can get access to its mapping boutique instantly.

POST /v2/boutiques

 - **Purpose**: Create a new boutique
 - **Considerations**: The boutique will only be created if the required parameters are sent in the request and if the slug is unique.

PUT /v2/boutiques/{slug}
- **Purpose**: Find boutique with given slug and update
 - **Considerations**: The boutique will only be updated if it can be found.

### Handling existing boutiques
Since boutiques initially didn't have 'google_places_id' (gpi) it was necessary to add a process to inject it. I decided to update the gpi every time the server is booted. This way, we make sure that the information is updated whenever we need to use it. The gpi will also be updated every time a boutique is created or updated.

Note: the gpi's will be updated if they are non-existant or if their value is '-1' as Google is constantly updating them.

### Google Places API
Created a simple client which makes requests to the Google API. The url used is in the form:
https://maps.googleapis.com/maps/api/place/findplacefromtext/json?inputtype=textquery&field=place_id&input&[NAME]&locationbias:point:[LAT],[LON]&key=[API_KEY].

Return Object:

    {
	    candidates: [
		    {
			    place_id: 'xyz'
			}
	    ]
	    status: 'OK'
    }

### Node Modules

 1. **axios**: to make requests simple (google-api)
 2. **body-parser**: to parse the body parameters as JSON
 3. **dotenv**: to save local environment variables (GOOGLE_API_KEY)
 4. **regenerator-runtime**: [https://github.com/babel/babel/issues/9849](https://github.com/babel/babel/issues/9849)
 5. **url**: to combine distinct fragments of url together in a safe way

## Considerations

 1. Assumed that
 2. Decided to use the slug as the "id" to GET and UPDATE boutiques as  it has to be unique by definition. I assumed a different service was responsible for
 3. Considered fixing the /docs endpoint so that my changes would be reflected on the API documentation, but decided that this should be done on a separate story as it's not the MVP. The docs could be generated by consuming comments above each route under the 'routes.js' file.
 4. I didn't add any integration tests as the one given was broken and fixing it was taking too much time. I gave priority to unit tests and sending the working code.

## How to run?
### App

 1. Google API Key
	 - Create *.env* file under *boutique-service*
	 - Add environment-specific variable on new line in the form of `GOOGLE_API_KEY=[YOUR_API_KEY]`
     - Note: if this step is not added, google_places_id's will all be populated with "-1" 
  2. Run service: `docker-compose up`

### Tests

Run tests: `npm test`
